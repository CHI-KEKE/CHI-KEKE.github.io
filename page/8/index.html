<!DOCTYPE html><html lang="zh" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>平屋慢生活 - Coding也是生活的溫暖調味</title><meta name="author" content="Allen"><meta name="copyright" content="Allen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="平屋慢生活">
<meta property="og:url" content="https://chi-keke.github.io/page/8/">
<meta property="og:site_name" content="平屋慢生活">
<meta property="og:locale">
<meta property="og:image" content="https://i.imgur.com/q4xr50n.png">
<meta property="article:author" content="Allen">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/q4xr50n.png"><link rel="shortcut icon" href="/img/kiwibird.png"><link rel="canonical" href="https://chi-keke.github.io/page/8/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '平屋慢生活',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2025-10-19 14:00:24'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.imgur.com/q4xr50n.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">123</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">15</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header" style="background-image: url('https://i.imgur.com/86eENHu.png')"><nav id="nav"><span id="blog-info"><a href="/" title="平屋慢生活"><span class="site-name">平屋慢生活</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">平屋慢生活</h1><div id="site_social_icons"><a class="social-icon" href="https://github.com/CHI-KEKE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:chilly37647@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/23/EF-NEW-EFCORE-Dapper/" title="Dapper vs EF Core"><img class="post-bg" src="https://github.com/CHI-KEKE/pics/blob/main/EF/ocean.png?raw=true" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dapper vs EF Core"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/23/EF-NEW-EFCORE-Dapper/" title="Dapper vs EF Core">Dapper vs EF Core</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-23T14:07:05.000Z" title="Created 2025-05-23 22:07:05">2025-05-23</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%B3%87%E6%96%99%E7%96%86%E7%95%8C%E7%9A%84%E8%88%AA%E5%9C%96/">資料疆界的航圖</a></span></div><div class="content">




如果資料存取是場人生選擇，那 EF Core 就像「全包式旅行團」：行李、住宿、行程幫你安排好，你只要準時上車；而 Dapper 則像「背包客自由行」：想去哪、怎麼走、要不要迷路，全靠你自己。

在 .NET 的世界裡，EF Core 與 Dapper 是資料存取的兩大門派，一個幫你包辦大小事，一個讓你操控每一行 SQL。
你可能常常陷入這種掙扎：
「欸現在這隻微服務要查一堆訂單、明細、客戶資料，我要不要用 EF？還是會變龜速大怪獸？」「有三層關聯欸，用 Dapper 要手動 map 到哭出來，欄位一多手都斷了吧…」


🌊 ORM

在開發應用程式時，資料通常儲存在資料庫（Database）中，而程式則是用物件（Object）在操作資料。但是資料庫與程式是兩種世界

資料庫用的是「表格」（table）來存資料，C# 用的是「物件」和「類別」

這兩個東西的結構不同、語言不同、邏輯也不同。


👉 ORM（Object-Relational Mapping）本質是什麼？

它是一座橋梁，幫你自動把「資料表」轉成「物件」，也幫你把你操作的物件轉回資料表格式，這個過程就叫做  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/20/EF-NEW-EFCORE-Scoped/" title="EF Core - DbContext 生命週期"><img class="post-bg" src="https://github.com/CHI-KEKE/pics/blob/main/EF/ocean.png?raw=true" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="EF Core - DbContext 生命週期"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/20/EF-NEW-EFCORE-Scoped/" title="EF Core - DbContext 生命週期">EF Core - DbContext 生命週期</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-20T07:28:05.000Z" title="Created 2025-05-20 15:28:05">2025-05-20</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%B3%87%E6%96%99%E7%96%86%E7%95%8C%E7%9A%84%E8%88%AA%E5%9C%96/">資料疆界的航圖</a></span></div><div class="content">




「這裡的風很大，請小心 DbContext 被吹出作用域。」

開發 ASP.NET Core 應用程式時，你一定碰過這段設定
1services.AddDbContext&lt;MyDbContext&gt;();
這一行註冊你的 DbContext，但你知道它的 生命週期（Lifetime）是什麼嗎？Scoped、Transient 差在哪？又該怎麼選擇？今天我們就來一趟資料庫生命週期的航行。
🌊 EF Core 的預設生命週期：ScopedEntity Framework contexts

By default, Entity Framework contexts are added to the service container using the    scoped lifetime because web app database operations are normally scoped to the client request.

簡單來說，EF Core 的 DbContext 預設會註冊成 Scoped，也就是，每個 HTTP Request 會 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/19/EF-NEW-EFCORE-Transaction/" title="EF Core - Transaction"><img class="post-bg" src="https://github.com/CHI-KEKE/pics/blob/main/EF/ocean.png?raw=true" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="EF Core - Transaction"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/19/EF-NEW-EFCORE-Transaction/" title="EF Core - Transaction">EF Core - Transaction</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-19T14:07:05.000Z" title="Created 2025-05-19 22:07:05">2025-05-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E8%B3%87%E6%96%99%E7%96%86%E7%95%8C%E7%9A%84%E8%88%AA%E5%9C%96/">資料疆界的航圖</a></span></div><div class="content">



🐧關於 Transaction在系統開發中，最可怕的狀況不是資料存不進去，而是「資料只成功了一半」。
你可能會覺得沒什麼——多一筆少一筆資料，好像影響不大。但實際上，這種「半成品」的狀態，才是造成系統錯誤與災難的根源。

使用者下單成功了，庫存卻沒扣 → 超賣
客戶付款完成，但系統沒記帳 → 客訴、查帳風暴
發票開出來了，卻沒連到訂單 → 財報對不起來

這些問題不是 bug，也不是 crash，而是資料邏輯不一致，讓系統表面正常、實際混亂。這時候，就需要一種「全部成功或全部失敗」的保護機制 —— 這就是 交易（Transaction） 的存在價值。
交易就像你畫圖時的一顆橡皮擦：如果中間畫錯了，可以整張擦掉重來，而不是留下殘破不堪的塗鴉。
Using Transactions


🌊 SaveChanges() 自動包成 Transaction在 EF Core 中，只要你呼叫 SaveChanges() 或 SaveChangesAsync()，它就會自動包一個隱含的交易（Implicit Transaction）。這代表：
1234567using (var cont ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/15/DI-Dependency-Injection-4/" title="Dependency Injection - 生命週期"><img class="post-bg" src="https://i.imgur.com/xAbpKgd.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dependency Injection - 生命週期"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/15/DI-Dependency-Injection-4/" title="Dependency Injection - 生命週期">Dependency Injection - 生命週期</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-15T00:07:05.000Z" title="Created 2025-05-15 08:07:05">2025-05-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%A3%AE/">注入之森</a></span></div><div class="content">穿過茂密的樹影與輕柔的晨霧，你走進了一座靜謐的森林。
那裡沒有 bug，沒有 exception，只有陽光灑落的參天樹、木製窗框散出香氣的小屋
你打開門，進入了一間森林旅宿。櫃檯小姐微笑地遞給你一張房卡，你今晚的房間已經準備好了。
對旅宿而言，房間是 Singleton 生命週期的服務，從你入住前到離開後，它始終如一地在那裡 —— 只建一次，長存不變
你看著桌上放著一組乾淨的 Scoped 盥洗用品：牙刷、毛巾、小瓶洗髮精。它們會陪你走完這段住宿時光，使用多少、如何使用，全由你決定。但當你退房時，它們也會一起離開，下一位旅人會拿到全新的組合。
角落還放著衛生紙，柔軟、乾淨，隨時可以撕下一張來使用。你不會重複用它，也不會留著它，只會在需要的時候取一張。這，就是 Transient：臨時、即用即丟、毫無記憶的存在。
不同的服務有不同的生命週期，就像不同的物品有不同的使用方式 —— 如果錯把盥洗用品作為 Singleton 使用，那麼下一位旅客來到時，拿到的可能就是使用過得噁心牙刷。
設計生命週期的本質，不是為了節省資源，而是為了讓每一段旅程，都能乾淨、清晰、可控地發生。請進吧，旅人。我們即 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/15/DI-Dependency-Injection-3/" title="Dependency Injection - 註冊、注入"><img class="post-bg" src="https://i.imgur.com/xAbpKgd.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dependency Injection - 註冊、注入"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/15/DI-Dependency-Injection-3/" title="Dependency Injection - 註冊、注入">Dependency Injection - 註冊、注入</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-15T00:07:05.000Z" title="Created 2025-05-15 08:07:05">2025-05-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%A3%AE/">注入之森</a></span></div><div class="content">
有一天，我夢見我死了。
地獄門口，閻羅王拿出一本厚厚的註冊清單，一邊唸：「根據你的 ServiceCollection，這輩子你註冊了以下幾項依賴…」
12345678IConfidenceService          → FakeItTillYouMakeItServiceILoveService                → UnhealthyAttachmentServiceILogger&lt;YourLife&gt;           → Mom&#x27;sConstantNaggingICareerPlanner              → JustFollowWhatEveryoneElseDidServiceISelfWorthEvaluator         → DependsOnLikesAndRetweetsServiceIPurposeOfLifeResolver      → null

我試圖抗議：「等等！我沒有註冊這些啊！」閻羅王翻了翻後台的 StackTrace，淡淡地說：「人走著走著、就註冊成這樣了。」
「每一次討好別人，你就呼叫了  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/13/DI-Dependency-Injection-2/" title="Dependency Injection - 靜態與依賴"><img class="post-bg" src="https://i.imgur.com/xAbpKgd.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dependency Injection - 靜態與依賴"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/13/DI-Dependency-Injection-2/" title="Dependency Injection - 靜態與依賴">Dependency Injection - 靜態與依賴</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-13T14:07:05.000Z" title="Created 2025-05-13 22:07:05">2025-05-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%A3%AE/">注入之森</a></span></div><div class="content">


今天到全聯購買了一個體重計，標籤上面寫著 static，售價 500 元。我心想：「不錯，夠便宜，看起來也夠簡單，剛好放在家門口踩一下就知道我今天有沒有胖。」回家之後，我站上去，顯示 66.6kg。
我不滿意。
我開始對著體重計自言自語：
「欸欸，我昨天吃太鹹啦，應該有水腫，不能算胖吧？」「還有，最近氣壓很低，影響感測精度你懂嗎？」「而且我最近壓力比較大可能會影響賀爾蒙，體脂肪是不是也該調整一下？」
我認真思考了一下，決定用 Dependency Injection 改造這台體重機。我開始設計以下注入內容：

IDietHistoryAnalyzer：幫我判斷昨天晚餐的影響，還會取得目前的健康最新趨勢分析
IPressureSensingService：計算壓力變動
IWeatherSensorProvider：拉取最新的氣壓與濕度資料

還打算加個 IMoodService，畢竟心情不好看起來也會比較腫，我把所有服務都準備好了，轉頭對體重機說：
「接下來，你要根據這些注入的資料來動態回傳我的理想體重。」
體重機沉默了幾秒，然後…… 它還是顯示了 66.6kg。不只沒變，它還開始 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/11/DI-Dependency-Injection-1/" title="Dependency Injection，不是控制，而是放手"><img class="post-bg" src="https://i.imgur.com/xAbpKgd.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dependency Injection，不是控制，而是放手"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/11/DI-Dependency-Injection-1/" title="Dependency Injection，不是控制，而是放手">Dependency Injection，不是控制，而是放手</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-11T04:50:05.000Z" title="Created 2025-05-11 12:50:05">2025-05-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%A3%AE/">注入之森</a></span></div><div class="content">
森林的深處，有一間小木屋。每當霧氣升起，樹葉發出細碎的聲響，動物們會緩緩走進這裡 —— 這裡不熱鬧，卻總是剛剛好。
一隻老貓躺在椅上，望著壁爐裡跳動的火光，輕輕說：「我們啊，無法事事都靠自己。」這裡的每一份溫暖，都不是自己製造的，而是來自彼此的信任與協作。柴火是兔子帶來的，窗簾是松鼠縫的，茶是隔壁小鹿泡的。屋子本身沒有準備這一切 —— 但正因為如此，它才如此輕盈。
我們不在類別中自行建構一切，也不強求自己了解每個細節。我們只需要設計出一個能被好好照顧的容器，然後放手交給外界來注入所需的一切。



🪵 怎麼理解 DI你都怎麼叫同事？
👨‍💻 RD：欸 PO📊 PO：怎樣 RD？
看起來好像有點冷淡，對吧？彼此之間只用職稱互稱，完全不知道對方是誰、是高是矮、是圓的扁的。但這其實就蘊含了 Dependency Injection 的精髓：

他們之間的互動，是依賴「抽象（角色）」，而不是「具體（人名）」

PO 並不在乎對面的 RD 是哪個腦殘，他只關心有能當 RD 的人，誰來都行，只要符合這個職責就好。這就是所謂的依賴抽象（依賴介面），而不是綁定具體對象。



🪵 李氏替換 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/11/Exception-Exception-CouponAPI/" title="錯誤防暴網設計 2 - 優惠券"><img class="post-bg" src="https://i.imgur.com/CxZINP1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="錯誤防暴網設計 2 - 優惠券"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/11/Exception-Exception-CouponAPI/" title="錯誤防暴網設計 2 - 優惠券">錯誤防暴網設計 2 - 優惠券</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-11T04:50:05.000Z" title="Created 2025-05-11 12:50:05">2025-05-11</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B7%B1%E5%A4%9C%E5%AE%88%E8%AD%B7%E8%80%85/">深夜守護者</a></span></div><div class="content">夜晚是多麼美好的事物呀！她張開雙臂，把整個世界，所有悲喜擁入懷中，沉默著傾聽萬物的低喃、嘆息、抱怨或喜訊。我多半時間都是歡迎她的，特別是在一天奔波後，滿身疲憊、挫折與委屈彷彿蘇軾《臨江仙》中的遊子，渴望遠離塵世喧囂，到一個毫無紛亂之地，過著簡單平安的一生。
然而，每當靜夜離去，我卻也不得不承認 —— 昨夜的自己，只是又一次在苦中找尋出口罷了。系統亦然。每一次錯誤的發生，也許令人焦躁，但若能妥善處理、柔和回應，就能讓使用者感受到：「啊，原來這個系統，是有被好好照顧過的。」



🧱 規劃我們定義的 GlobalExceptionHandler

UseExceptionHandler 是什麼？當你開發一個 ASP.NET Core 應用時，難免會碰上各式各樣的例外（Exception），這時候，如果每個地方都用 try-catch 包起來，不但重複、難維護，還容易漏掉。ASP.NET Core 為此提供了一個現成的機制：app.UseExceptionHandler(…)，讓你能夠集中處理應用程式中的所有錯誤。
根據官方文件, 例外處理器 Lambda 函數，這個方法可以讓你註冊一條錯 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2025/05/10/Exception-Exception-API-Design-StatusCode/" title="你說你 200，但我知道你快崩潰了"><img class="post-bg" src="https://i.imgur.com/CxZINP1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="你說你 200，但我知道你快崩潰了"></a></div><div class="recent-post-info"><a class="article-title" href="/2025/05/10/Exception-Exception-API-Design-StatusCode/" title="你說你 200，但我知道你快崩潰了">你說你 200，但我知道你快崩潰了</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2025-05-10T03:23:05.000Z" title="Created 2025-05-10 11:23:05">2025-05-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B7%B1%E5%A4%9C%E5%AE%88%E8%AD%B7%E8%80%85/">深夜守護者</a></span></div><div class="content">
夜已深，桌上的燈還亮著。你坐在螢幕前，滑著那些 commit 記錄，畫面一行一行閃爍著變更的痕跡。世界安靜下來時，反而讓人開始聽見自己的內心。
那是一段日子，你明明撐得很辛苦，卻還是對朋友說：「我很好。」就像有的 API，明明出錯了，卻還是包裝成一個 200 OK。你開始意識到，有些錯誤不是程式的錯，而是我們不願意讓人知道「其實我現在沒那麼好」。但 API 和人都一樣。你不說，別人只會以為你真的沒事。錯了，就該勇敢說出口。這不只是對外部的交代，更是對自己的一種體貼。



🧳 RESTful 派的觀點：讓 HTTP status 說話WebAPI 出錯時，是否必須透過 HTTP Status 反映執行結果，例如：找不到時吐 404、系統出錯時回應 500？
在這個 API 世界裡，RESTful 就像是遵守交通號誌的好市民：綠燈行，紅燈停，該錯就錯，該成功就成功，乾淨俐落。


🎯 HTTP Status 是最基本的語言禮儀RESTful 設計精神強調：HTTP Status Code 本來就是用來傳達狀態的。

2xx：成功（200 OK、201 Created）
4xx：客戶 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2024/12/06/Exception-Exception-PaymentMiddleware/" title="金流中介者之 Exception 防暴網設計"><img class="post-bg" src="https://i.imgur.com/CxZINP1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="金流中介者之 Exception 防暴網設計"></a></div><div class="recent-post-info"><a class="article-title" href="/2024/12/06/Exception-Exception-PaymentMiddleware/" title="金流中介者之 Exception 防暴網設計">金流中介者之 Exception 防暴網設計</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2024-12-06T09:25:05.000Z" title="Created 2024-12-06 17:25:05">2024-12-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/%E6%B7%B1%E5%A4%9C%E5%AE%88%E8%AD%B7%E8%80%85/">深夜守護者</a></span></div><div class="content">
💵 站台建立的目的這是一個專門串接多家第三方金流的站台，前台可以依照情況切換不同金流提供者。整個站台的角色是「金流中介者」，幫助前台整合各家金流流程。
在這樣的架構下，例外處理（Exception Handling）變得非常關鍵。因為錯誤不僅可能來自系統內部，也可能是來自外部金流系統的 timeout、錯誤參數或伺服器無回應等狀況。
因此，我們使用 ExceptionHandlerMiddleware 來當作 API 的防爆層（Fallback Layer），讓：

內部開發者能清楚知道發生什麼錯
外部串接方只看到簡單明確的錯誤資訊

這樣能確保資訊安全，同時提升除錯效率。



💵 Global ExceptionMiddleware設計的重點：

捕捉所有未處理的 Exception
記錄 Log
給用戶一種統一格式的 JSON 回應
在 Debug 模式下額外附上 StackTrace

實作參考
1234567891011121314151617181920212223242526272829303132333435363738394041424344    public ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/7/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/#content-inner">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/#content-inner">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/#content-inner">13</a><a class="extend next" rel="next" href="/page/9/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.imgur.com/q4xr50n.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Allen</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">123</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/CHI-KEKE"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/CHI-KEKE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:chilly37647@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">世界總會有那些溫暖的小角落們等待發現</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/15/SQL-SQL-Performance/" title="Performance"><img src="https://i.imgur.com/NfCnwwU.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Performance"/></a><div class="content"><a class="title" href="/2025/10/15/SQL-SQL-Performance/" title="Performance">Performance</a><time datetime="2025-10-15T00:57:05.000Z" title="Created 2025-10-15 08:57:05">2025-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/15/SQL-SQL-Sequence/" title="執行順序"><img src="https://i.imgur.com/NfCnwwU.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="執行順序"/></a><div class="content"><a class="title" href="/2025/10/15/SQL-SQL-Sequence/" title="執行順序">執行順序</a><time datetime="2025-10-15T00:57:05.000Z" title="Created 2025-10-15 08:57:05">2025-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/14/SQL-SQL-Cheetsheet/" title="CheetSheet"><img src="https://i.imgur.com/NfCnwwU.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CheetSheet"/></a><div class="content"><a class="title" href="/2025/10/14/SQL-SQL-Cheetsheet/" title="CheetSheet">CheetSheet</a><time datetime="2025-10-14T00:06:05.000Z" title="Created 2025-10-14 08:06:05">2025-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/13/SQL-SQL-field/" title="Field"><img src="https://i.imgur.com/NfCnwwU.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Field"/></a><div class="content"><a class="title" href="/2025/10/13/SQL-SQL-field/" title="Field">Field</a><time datetime="2025-10-13T14:52:05.000Z" title="Created 2025-10-13 22:52:05">2025-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/12/SQL-SQL-index-2/" title="Index - 發揮作用...了嗎"><img src="https://i.imgur.com/NfCnwwU.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Index - 發揮作用...了嗎"/></a><div class="content"><a class="title" href="/2025/10/12/SQL-SQL-index-2/" title="Index - 發揮作用...了嗎">Index - 發揮作用...了嗎</a><time datetime="2025-10-12T05:51:05.000Z" title="Created 2025-10-12 13:51:05">2025-10-12</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="View More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Config/"><span class="card-category-list-name">Config</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/MVC/"><span class="card-category-list-name">MVC</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/SQL-%E8%81%B7%E5%A0%B4%E6%AD%B7%E9%9A%AA%E8%A8%98/"><span class="card-category-list-name">SQL 職場歷險記</span><span class="card-category-list-count">17</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/WebAPI/"><span class="card-category-list-name">WebAPI</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%9A%97%E5%8F%B7%E8%80%85%E3%81%AE%E7%A7%98%E5%AF%86%E3%81%AE%E9%83%A8%E5%B1%8B/"><span class="card-category-list-name">暗号者の秘密の部屋</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%9C%AA%E6%9D%A5%E3%82%88%E3%82%8A%E3%81%AE%E8%BF%94%E6%AD%8C/"><span class="card-category-list-name">未来よりの返歌</span><span class="card-category-list-count">12</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%B3%A8%E5%85%A5%E4%B9%8B%E6%A3%AE/"><span class="card-category-list-name">注入之森</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/%E6%B7%B1%E5%A4%9C%E5%AE%88%E8%AD%B7%E8%80%85/"><span class="card-category-list-name">深夜守護者</span><span class="card-category-list-count">9</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Encode/" style="font-size: 1.1em; color: #999">Encode</a> <a href="/tags/Cache/" style="font-size: 1.19em; color: #999da1">Cache</a> <a href="/tags/Plugin-Pattern%EF%BC%88%E5%A4%96%E6%8E%9B%E6%A8%A1%E5%BC%8F%EF%BC%89x-Factory-Method-Pattern%EF%BC%88%E5%B7%A5%E5%BB%A0%E6%96%B9%E6%B3%95%EF%BC%89x-Strategy-Pattern%EF%BC%88%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%EF%BC%89/" style="font-size: 1.1em; color: #999">Plugin Pattern（外掛模式）x Factory Method Pattern（工廠方法）x Strategy Pattern（策略模式）</a> <a href="/tags/ASP-NET-Core/" style="font-size: 1.1em; color: #999">ASP.NET Core</a> <a href="/tags/Delegate/" style="font-size: 1.19em; color: #999da1">Delegate</a> <a href="/tags/SOLID/" style="font-size: 1.1em; color: #999">SOLID</a> <a href="/tags/Code/" style="font-size: 1.1em; color: #999">Code</a> <a href="/tags/SQL-%E8%81%B7%E5%A0%B4%E6%AD%B7%E9%9A%AA%E8%A8%98/" style="font-size: 1.32em; color: #99a2ae">SQL 職場歷險記</a> <a href="/tags/Dependency-Injection/" style="font-size: 1.23em; color: #999ea6">Dependency Injection</a> <a href="/tags/Enum/" style="font-size: 1.19em; color: #999da1">Enum</a> <a href="/tags/JSON/" style="font-size: 1.14em; color: #999b9d">JSON</a> <a href="/tags/SQL/" style="font-size: 1.1em; color: #999">SQL</a> <a href="/tags/Asynchronous-Programming/" style="font-size: 1.5em; color: #99a9bf">Asynchronous Programming</a> <a href="/tags/EF-CORE/" style="font-size: 1.5em; color: #99a9bf">EF CORE</a> <a href="/tags/WebAPI/" style="font-size: 1.37em; color: #99a4b2">WebAPI</a> <a href="/tags/Exception-Handling/" style="font-size: 1.41em; color: #99a5b7">Exception Handling</a> <a href="/tags/%E8%A8%80%E8%91%89%E7%B9%94%E3%82%8A/" style="font-size: 1.46em; color: #99a7bb">言葉織り</a> <a href="/tags/Design/" style="font-size: 1.28em; color: #99a0aa">Design</a> <a href="/tags/LINQ/" style="font-size: 1.1em; color: #999">LINQ</a> <a href="/tags/Unicode/" style="font-size: 1.1em; color: #999">Unicode</a> <a href="/tags/HttpClient/" style="font-size: 1.1em; color: #999">HttpClient</a> <a href="/tags/Http/" style="font-size: 1.32em; color: #99a2ae">Http</a> <a href="/tags/Delegate-x-Observer-Pattern/" style="font-size: 1.1em; color: #999">Delegate x Observer Pattern</a> <a href="/tags/MVC/" style="font-size: 1.23em; color: #999ea6">MVC</a> <a href="/tags/%E9%A2%A8%E9%9F%B3%E5%AD%90/" style="font-size: 1.1em; color: #999">風音子</a> <a href="/tags/C/" style="font-size: 1.28em; color: #99a0aa">C#</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="View More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">October 2025</span><span class="card-archive-list-count">15</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">September 2025</span><span class="card-archive-list-count">30</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><span class="card-archive-list-count">10</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">May 2025</span><span class="card-archive-list-count">17</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">December 2024</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">November 2024</span><span class="card-archive-list-count">5</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">123</div></div><div class="webinfo-item"><div class="item-name">Runtime :</div><div class="item-count" id="runtimeshow" data-publishDate="2024-03-01T10:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Update :</div><div class="item-count" id="last-push-date" data-lastPushDate="2025-10-19T06:00:23.685Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.imgur.com/yZlXwed.png')"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By Allen</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">What you'll find out there is boundless freedom !</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>